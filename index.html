<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Tycoon - Master India's Power Grid</title>
    <meta name="description" content="Interactive game for mapping India's power infrastructure using OpenStreetMap and JOSM">
    <meta name="keywords" content="OpenStreetMap, JOSM, power grid, India, mapping, game">
    <link rel="icon" type="image/png" href="media/logo/logo.png">
    <link rel="stylesheet" href="css/styles.css">

    <!-- Leaflet CSS for Map Visualization -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
</head>
<body>
    <!-- Landing Page Section (Full Screen) -->
    <section id="landingSection" class="landing-section">
        <!-- Minimal Navigation Header -->
        <nav class="landing-nav">
            <div class="nav-brand">
                <img src="media/logo/logo.png" alt="Grid Tycoon Logo" class="nav-logo">
                <span>Grid Tycoon</span>
            </div>
            <div class="nav-links">
                <a href="#how-to-play" class="nav-link" onclick="app.showHowToPlay(); return false;">How to Play</a>
                <a href="#resources" class="nav-link" onclick="app.showResourcesModal(); return false;">Resources</a>
                <a href="https://mapyourgrid.org" target="_blank" rel="noopener noreferrer" class="nav-link">MapYourGrid</a>
                <a href="#get-started" class="nav-link nav-link-primary" onclick="app.showRegistrationFromLanding(); return false;">Get Started</a>
            </div>
        </nav>

        <!-- Centered Overlay Content -->
        <div class="landing-content">
            <img src="media/logo/logo.png" alt="Grid Tycoon Logo" class="landing-hero-logo">
            <h1 class="landing-title">Master India's Power Grid</h1>
            <p class="landing-subtitle">Collaborative mapping through OpenStreetMap</p>
        </div>
    </section>

    <!-- How to Play Page (Full Screen) -->
    <section id="howToPlaySection" class="how-to-play-page" style="display: none;">
        <!-- Minimal Navigation Header -->
        <nav class="landing-nav">
            <div class="nav-brand" style="cursor: pointer;" onclick="app.returnToLanding()">
                <img src="media/logo/logo.png" alt="Grid Tycoon Logo" class="nav-logo">
                <span>Grid Tycoon</span>
            </div>
        </nav>

        <!-- Scrollable Content -->
        <div class="guide-container">
            <div class="guide-content">
                <h1 class="guide-main-title">How to Play Grid Tycoon</h1>
                <p class="guide-main-subtitle">A comprehensive guide to collaborative power grid mapping across India</p>

                <!-- Section 1: What is Grid Tycoon? -->
                <section class="guide-section">
                    <h2 class="section-title">What is Grid Tycoon?</h2>
                    <p>Grid Tycoon transforms the serious work of infrastructure mapping into an engaging collaborative experience. Teams of mappers work together to document India's electrical grid on OpenStreetMap, creating valuable open data that serves communities, planners, and researchers.</p>

                    <div class="info-card info-card-primary">
                        <h3>Why Map the Power Grid?</h3>
                        <ul>
                            <li><strong>Emergency Response:</strong> Better maps help first responders during disasters and outages</li>
                            <li><strong>Urban Planning:</strong> Accurate infrastructure data supports sustainable development</li>
                            <li><strong>Research:</strong> Open data enables energy studies and infrastructure analysis</li>
                            <li><strong>Community:</strong> Local knowledge combined with satellite imagery creates comprehensive maps</li>
                        </ul>
                    </div>

                    <p>Grid Tycoon gamifies this process by organizing participants into teams, distributing territories across India's 36 states and union territories, and tracking progress through leaderboards and statistics.</p>
                </section>

                <!-- Section 2: Getting Started -->
                <section class="guide-section">
                    <h2 class="section-title">Getting Started</h2>

                    <h3>Prerequisites</h3>
                    <ol class="numbered-list">
                        <li>
                            <strong>OpenStreetMap Account</strong>
                            <p>Create a free account at <a href="https://www.openstreetmap.org" target="_blank" rel="noopener noreferrer">openstreetmap.org</a>. You'll need your OSM username to register for Grid Tycoon.</p>
                        </li>
                        <li>
                            <strong>JOSM Editor</strong>
                            <p>Download and install JOSM from <a href="https://josm.openstreetmap.de" target="_blank" rel="noopener noreferrer">josm.openstreetmap.de</a>. JOSM is the preferred editor for Grid Tycoon because it handles large areas efficiently and supports advanced mapping features.</p>
                        </li>
                        <li>
                            <strong>Session ID</strong>
                            <p>Get a session ID from your coordinator. This unique code connects you to your mapping session.</p>
                        </li>
                    </ol>

                    <h3>Registration Process</h3>
                    <div class="step-by-step">
                        <div class="step-item">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h4>Visit Grid Tycoon</h4>
                                <p>Navigate to the Grid Tycoon application and click "Get Started"</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h4>Enter Your Details</h4>
                                <p>Provide your first name, OpenStreetMap username, and session ID</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h4>Wait for Team Assignment</h4>
                                <p>The coordinator will form teams once enough participants have registered</p>
                            </div>
                        </div>
                        <div class="step-item">
                            <div class="step-number">4</div>
                            <div class="step-content">
                                <h4>Start Mapping!</h4>
                                <p>Once assigned, you'll see your team dashboard and territories to map</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Section 3: Understanding Roles -->
                <section class="guide-section">
                    <h2 class="section-title">Team Roles Explained</h2>
                    <p>Each team consists of exactly three members, each with a specialized role. This division of labor ensures comprehensive, accurate mapping.</p>

                    <div class="role-cards-grid">
                        <div class="role-card role-card-pioneer">
                            <div class="role-header">
                                <span class="role-icon-large">üó∫Ô∏è</span>
                                <h3>Pioneer</h3>
                            </div>
                            <p class="role-tagline">The Trailblazer</p>
                            <div class="role-details">
                                <h4>Primary Responsibilities:</h4>
                                <ul>
                                    <li>Trace power lines from satellite imagery</li>
                                    <li>Identify and map major substations</li>
                                    <li>Add basic tags to infrastructure features</li>
                                    <li>Cover large areas quickly to establish base map</li>
                                </ul>

                                <h4>Key Skills:</h4>
                                <ul>
                                    <li>Satellite imagery interpretation</li>
                                    <li>Line tracing accuracy</li>
                                    <li>Basic OSM tagging knowledge</li>
                                </ul>

                                <h4>Tips for Success:</h4>
                                <ul>
                                    <li>Start with clearly visible transmission lines</li>
                                    <li>Use imagery with the best resolution</li>
                                    <li>Don't worry about perfect accuracy - Technician will refine</li>
                                    <li>Mark uncertain features for team review</li>
                                </ul>
                            </div>
                        </div>

                        <div class="role-card role-card-technician">
                            <div class="role-header">
                                <span class="role-icon-large">‚ö°</span>
                                <h3>Technician</h3>
                            </div>
                            <p class="role-tagline">The Precision Expert</p>
                            <div class="role-details">
                                <h4>Primary Responsibilities:</h4>
                                <ul>
                                    <li>Add detailed technical tags (voltage, frequency, operator)</li>
                                    <li>Verify and correct power line classifications</li>
                                    <li>Ensure naming consistency across features</li>
                                    <li>Cross-reference with external data sources</li>
                                </ul>

                                <h4>Key Skills:</h4>
                                <ul>
                                    <li>Understanding of power infrastructure terminology</li>
                                    <li>Attention to detail</li>
                                    <li>Knowledge of OSM tagging standards</li>
                                </ul>

                                <h4>Tips for Success:</h4>
                                <ul>
                                    <li>Consult the OSM Wiki for power=* tagging standards</li>
                                    <li>Use consistent naming conventions</li>
                                    <li>Document voltage information when visible</li>
                                    <li>Add references (ref=*) for officially numbered features</li>
                                </ul>
                            </div>
                        </div>

                        <div class="role-card role-card-seeker">
                            <div class="role-header">
                                <span class="role-icon-large">üîç</span>
                                <h3>Seeker</h3>
                            </div>
                            <p class="role-tagline">The Detective</p>
                            <div class="role-details">
                                <h4>Primary Responsibilities:</h4>
                                <ul>
                                    <li>Find infrastructure missed in initial mapping</li>
                                    <li>Verify existing features against multiple sources</li>
                                    <li>Check industrial areas for substations</li>
                                    <li>Research features that are difficult to identify</li>
                                </ul>

                                <h4>Key Skills:</h4>
                                <ul>
                                    <li>Research and investigation</li>
                                    <li>Pattern recognition</li>
                                    <li>Critical thinking</li>
                                </ul>

                                <h4>Tips for Success:</h4>
                                <ul>
                                    <li>Compare multiple imagery sources</li>
                                    <li>Look for telltale signs: cleared corridors, tower shadows</li>
                                    <li>Check near industrial zones and power plants</li>
                                    <li>Use Osmose QA tool to find issues</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="info-card info-card-success">
                        <h3>Team Collaboration is Key</h3>
                        <p>While each role has specific responsibilities, successful teams communicate and support each other. Pioneers can flag features for Technicians to detail, Seekers can guide Pioneers to missed areas, and Technicians can educate others on tagging standards.</p>
                    </div>
                </section>

                <!-- Section 4: Ready to Start -->
                <section class="guide-section guide-footer">
                    <h2 class="section-title-centered">Ready to Map India's Power Grid?</h2>
                    <p class="footer-text">You now have everything you need to become an effective Grid Tycoon mapper. Join a session, collaborate with your team, and help build the most comprehensive open map of India's electrical infrastructure!</p>

                    <div class="footer-actions">
                        <button class="btn btn-primary btn-large" onclick="app.showRegistrationFromLanding()">Get Started Now</button>
                        <a href="https://mapyourgrid.org" target="_blank" rel="noopener noreferrer" class="btn btn-secondary btn-large">Learn More About MapYourGrid</a>
                    </div>

                    <div class="footer-quote">
                        <blockquote>
                            "Every power line you map contributes to open data that serves communities, researchers, and emergency responders across India. Thank you for being part of this collaborative effort!"
                        </blockquote>
                    </div>
                </section>
            </div>
        </div>
    </section>

    <div class="container">
        <header class="header" style="display: none;">
            <div class="header-nav">
                <a href="#home" class="header-brand" onclick="app.returnToLanding(); return false;">
                    <img src="media/logo/logo.png" alt="Grid Tycoon Logo" class="header-logo">
                    <span>Grid Tycoon</span>
                </a>
                <div class="header-nav-links" id="headerNavLinks">
                    <!-- Navigation buttons will be populated by JavaScript -->
                </div>
            </div>
        </header>

        <!-- Registration Section -->
        <section id="registrationSection" class="section registration-page" style="display: none;">
            <div class="section-header">
                <h2>Join Mapping Session</h2>
                <p class="section-description">
                    Enter your details to check team assignment or register for a new session.
                </p>
                <p class="help-text">
                    <strong>Coordinators:</strong> Use session ID with "COORD" or "ADMIN" for coordinator access.
                </p>
            </div>

            <div class="form-container">
                <div class="form-group">
                    <label for="firstNameInput" class="form-label">First Name</label>
                    <input type="text" id="firstNameInput" class="form-input" placeholder="Enter your first name" required>
                </div>
                <div class="form-group">
                    <label for="osmUsernameInput" class="form-label">OSM Username</label>
                    <input type="text" id="osmUsernameInput" class="form-input" placeholder="Your OpenStreetMap username" required>
                </div>
                <div class="form-group">
                    <label for="sessionIdInput" class="form-label">Session ID</label>
                    <input type="text" id="sessionIdInput" class="form-input" placeholder="e.g., 12345 or 12345-COORD" required>
                </div>
                <button class="btn btn-primary" onclick="app.checkUserStatus()">
                    Check Status / Register
                </button>
            </div>
        </section>

        <!-- Coordinator Dashboard Section -->
        <section id="coordinatorSection" class="section" style="display: none;">
            <div id="coordinatorDashboard">
                <!-- Coordinator dashboard content will be populated by JavaScript -->
            </div>
        </section>

        <!-- Team/Participant Section -->
        <section id="teamSection" class="section" style="display: none;">
            <div id="teamDisplay">
                <!-- Team dashboard content will be populated by JavaScript -->
            </div>
        </section>

        <!-- Mapping Interface Section -->
        <section id="mappingSection" class="section" style="display: none;">
            <div id="mappingDisplay">
                <!-- Mapping interface content will be populated by JavaScript -->
            </div>
        </section>
        
        <!-- Status Messages -->
        <div id="statusDiv" class="status" style="display: none;" role="alert" aria-live="polite">
            <!-- Status messages will be populated by JavaScript -->
        </div>
        
        <!-- Modals -->
        <div id="infoModal" class="modal" style="display: none;" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
            <div class="modal-content">
                <div id="infoModalContent">
                    <!-- Modal content will be populated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div id="josmModal" class="modal" style="display: none;" role="dialog" aria-labelledby="josm-modal-title" aria-hidden="true">
            <div class="modal-content">
                <div id="josmModalContent">
                    <!-- JOSM modal content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Configuration -->
    <script>
        // Application Configuration
        window.GRID_TYCOON_CONFIG = {
            // Database Configuration
            database: {
                url: 'https://vsmfugcgmnahnybdyslf.supabase.co',
                anonKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzbWZ1Z2NnbW5haG55YmR5c2xmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgwNzU5MjgsImV4cCI6MjA3MzY1MTkyOH0.ct5JupOIbE5zicOWb1mrWGJtoHNHdV6XdRsXCS0WjBs'
            },
            
            // Overpass API Configuration  
            overpass: {
                servers: [
                    'https://overpass-api.de/api/interpreter',
                    'https://overpass.kumi.systems/api/interpreter', 
                    'https://overpass.openstreetmap.fr/api/interpreter'
                ],
                timeout: 1800
            },
            
            // Application Settings
            app: {
                mockMode: false,
                debugMode: false,
                fallbackToIndividualMode: false,
                version: '3.0'
            },

            // JOSM Integration Configuration (optional)
            josm: {
                host: 'localhost',
                port: 8111,
                timeout: 5000,
                imagerySources: [
                    { id: 'Mapbox', name: 'Mapbox Satellite' },
                    { id: 'Bing', name: 'Bing Aerial Imagery' },
                    { id: 'EsriWorldImagery', name: 'Esri World Imagery' }
                ]
            },

            // Map Visualization Configuration (optional)
            map: {
                enabled: false,  // Set to true when ready to use map features
                containerId: 'mapContainer',
                center: [22.5937, 78.9629],  // India center coordinates
                zoom: 5,
                minZoom: 4,
                maxZoom: 12
            }
        };
    </script>

    <!-- External Dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Leaflet JS for Map Visualization -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Application Components -->
    <script src="js/overpass.js"></script>
    <script src="js/supabase.js"></script>
    <script src="js/app.js"></script>

    <!-- Optional Feature Modules -->
    <script src="js/josmIntegration.js"></script>
    <script src="js/territoryMap.js"></script>
    <script src="js/osmose.js"></script>

    <!-- Initialize Application -->
    <script>
        // Global application instance
        let app;
        
        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            try {
                app = new GridTycoonApp();
                console.log('Grid Tycoon application initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Grid Tycoon:', error);
                
                // Show error message to user
                const statusDiv = document.getElementById('statusDiv');
                if (statusDiv) {
                    statusDiv.style.display = 'block';
                    statusDiv.className = 'status status-error';
                    statusDiv.textContent = `Application failed to start: ${error.message}. Please check the console for details.`;
                }
            }
        });
        
        // Global event handlers for modal clicks
        window.addEventListener('click', function(event) {
            const infoModal = document.getElementById('infoModal');
            const josmModal = document.getElementById('josmModal');
            
            if (event.target === infoModal) {
                app && app.closeModal();
            }
            if (event.target === josmModal) {
                app && app.closeModal();
            }
        });
        
        // Global keyboard handlers
        window.addEventListener('keydown', function(event) {
            // Close modal on Escape key
            if (event.key === 'Escape') {
                app && app.closeModal();
            }
        });
    </script>
</body>
</html>