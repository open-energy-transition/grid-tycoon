<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Tycoon - Master India's Power Grid</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="description" content="Interactive game for mapping India's power infrastructure using OpenStreetMap and JOSM">
    <meta name="keywords" content="OpenStreetMap, JOSM, power grid, India, mapping, game">
</head>
<body>
    <div class="container">
        <header class="game-header">
            <h1 class="game-title">⚡ GRID TYCOON ⚡</h1>
            <p class="game-subtitle">Master India's Power Infrastructure Network</p>
        </header>
        
        <div class="rules-section">
            <h2 class="rules-title">🎮 How to Play</h2>
            <ul class="rules-list">
                <li>🗺️ Map power infrastructure (≥50kV) across all Indian states and territories</li>
                <li>🎲 Each state can only be conquered once - choose wisely!</li>
                <li>📡 Data loads into JOSM for professional editing (manual links due to browser security)</li>
                <li>📥 Alternative: Download OSM files directly if JOSM links don't work</li>
                <li>🏆 Complete all regions to become the ultimate Grid Tycoon!</li>
            </ul>
        </div>
        
        <div id="initSection" class="game-card init-section">
            <h3>🚀 Initialize Power Grid Discovery</h3>
            <p style="margin: 20px 0; font-size: 1.1rem;">
                Begin your journey by discovering all Indian states and territories. 
                The system will try to fetch live data from OpenStreetMap, with embedded fallback data if needed.
            </p>
            <button class="btn btn-warning power-effect" onclick="initializeStates()">
                📡 Discover Territory Network
            </button>
            
            <div id="josmInstructions" class="josm-setup-info" style="display: none;">
                <!-- JOSM instructions will be populated here -->
            </div>
        </div>
        
        <div id="gameSection" class="game-section" style="display: none;">
            <div class="game-card">
                <div class="controls">
                    <button class="btn btn-primary power-effect" id="drawBtn" onclick="drawRandomState()">
                        🎲 Select Random Territory
                    </button>
                    <button class="btn btn-success" id="loadBtn" onclick="showJOSMLink()" disabled>
                        📡 Load into JOSM
                    </button>
                    <button class="btn btn-info" id="downloadBtn" onclick="generateDownloadLink()" disabled>
                        📥 Download OSM Data
                    </button>
                    <button class="btn btn-danger" id="markCompleteBtn" onclick="markCurrentComplete()" disabled>
                        ✅ Mark Territory Complete
                    </button>
                </div>
                
                <div class="secondary-controls">
                    <button class="btn btn-warning" onclick="resetGame()">
                        🔄 Reset Campaign
                    </button>
                    <button class="btn btn-secondary" onclick="saveGame()">
                        💾 Save Progress
                    </button>
                    <button class="btn btn-secondary" onclick="loadGame()">
                        📂 Load Progress
                    </button>
                    <button class="btn btn-secondary" onclick="showQueryInfo()">
                        🔍 Query Details
                    </button>
                </div>
                
                <div id="currentState" class="game-card current-state" style="display: none;">
                    <h2>🎯 Current Target Territory</h2>
                    <div class="state-name" id="currentStateName"></div>
                    <div class="state-details" id="stateDetails"></div>
                </div>
            </div>
            
            <div class="game-card">
                <div class="progress-section">
                    <div class="progress-header">
                        <h3 class="progress-title">📊 Campaign Progress</h3>
                        <div class="progress-stats" id="progressStats">0/0 Complete</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%;">
                            <span id="progressText">Ready to Start</span>
                        </div>
                    </div>
                </div>
                
                <div class="states-grid" id="statesGrid"></div>
            </div>
        </div>
        
        <div id="statusDiv" class="status" style="display: none;"></div>
        
        <!-- JOSM Modal -->
        <div id="josmModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div id="josmModalContent">
                    <!-- JOSM instructions and links will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Info Modal -->
        <div id="infoModal" class="modal" style="display: none;">
            <div class="modal-content">
                <div id="infoModalContent">
                    <!-- Query info will be populated here -->
                </div>
            </div>
        </div>
        
        <div class="game-card info-section">
            <h3 class="info-title">⚙️ JOSM Setup Guide</h3>
            <div class="setup-warning">
                <h4>🔒 Important: Browser Security Notice</h4>
                <p>Due to HTTPS security restrictions on GitHub Pages, JOSM connections require manual clicking instead of automatic loading. This is normal and expected behavior.</p>
            </div>
            <ul class="info-list">
                <li>🔧 <strong>Enable JOSM Remote Control:</strong> Preferences → Remote Control → ✅ Enable remote control</li>
                <li>🌐 <strong>Port Configuration:</strong> Ensure port 8111 is active (default configuration)</li>
                <li>💻 <strong>Keep JOSM Running:</strong> JOSM must be open while using Grid Tycoon</li>
                <li>⚡ <strong>Data Coverage:</strong> Queries fetch power infrastructure ≥50kV with administrative boundaries</li>
                <li>📥 <strong>Alternative Method:</strong> Use the Download button if JOSM links are blocked</li>
                <li>🔥 <strong>Firewall:</strong> Ensure your firewall allows connections to localhost:8111</li>
            </ul>
        </div>
        
        <div class="game-card troubleshooting-section">
            <h3 class="info-title">🛠️ Troubleshooting</h3>
            <ul class="info-list">
                <li>
                    <strong>JOSM Link Not Working?</strong>
                    <ul>
                        <li>Copy the link and paste it directly into your browser's address bar</li>
                        <li>Check that JOSM is running with Remote Control enabled</li>
                        <li>Try allowing mixed content for this site in browser settings</li>
                        <li>Use the Download option as an alternative</li>
                    </ul>
                </li>
                <li>
                    <strong>No States Loading?</strong>
                    <ul>
                        <li>The system will automatically fall back to embedded data if the API fails</li>
                        <li>Check your internet connection</li>
                        <li>Try refreshing the page</li>
                    </ul>
                </li>
                <li>
                    <strong>Overpass Query Timeout?</strong>
                    <ul>
                        <li>Some queries may take time due to complex power infrastructure data</li>
                        <li>Try the query again - different servers may respond faster</li>
                        <li>Consider using a smaller state/territory first</li>
                    </ul>
                </li>
            </ul>
        </div>
        
        <div class="game-card technical-section">
            <h3 class="info-title">🔧 Technical Details</h3>
            <div class="tech-grid">
                <div class="tech-item">
                    <h4>🌐 Data Sources</h4>
                    <ul>
                        <li>Primary: Overpass API (live OSM data)</li>
                        <li>Fallback: Embedded state data</li>
                        <li>Multiple server redundancy</li>
                    </ul>
                </div>
                <div class="tech-item">
                    <h4>⚡ Infrastructure Types</h4>
                    <ul>
                        <li>Transmission lines (≥50kV)</li>
                        <li>Substations & switching stations</li>
                        <li>Power plants & generators</li>
                        <li>Transformers & grid control</li>
                        <li>Construction projects</li>
                    </ul>
                </div>
                <div class="tech-item">
                    <h4>🔗 Integration</h4>
                    <ul>
                        <li>JOSM Remote Control API</li>
                        <li>Direct OSM file downloads</li>
                        <li>XML format for JOSM compatibility</li>
                        <li>Administrative boundary context</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer class="footer">
            <p>Grid Tycoon v2.0 | Powered by OpenStreetMap & JOSM | Built for Power Infrastructure Mapping</p>
            <p><small>🔒 GitHub Pages Compatible • 📡 JOSM Integration • 🗺️ OpenStreetMap Data</small></p>
        </footer>
    </div>

    <script src="overpass.js"></script>
    <script src="game.js"></script>
</body>
</html>